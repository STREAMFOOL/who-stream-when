{{template "base" .}}

{{define "title"}}Search - Who Live When{{end}}

{{define "content"}}
<a href="/" class="back-link">‚Üê Back to Home</a>

<div class="page-header">
    <h1>Search Streamers</h1>
    {{if .Query}}
    <p>Results for "{{.Query}}"</p>
    {{else}}
    <p>Find streamers on Kick to add to your tracker</p>
    {{end}}
</div>

<!-- Search Form -->
<form action="/search" method="POST" class="search-form" hx-post="/search" hx-target="#search-results"
    hx-swap="innerHTML" hx-indicator="#search-spinner">
    <input type="text" name="query" value="{{.Query}}" placeholder="Search for streamers..." required>
    <button type="submit" class="btn btn-primary">
        Search
        <span id="search-spinner" class="htmx-indicator loading-spinner"></span>
    </button>
</form>

<div id="search-results" class="search-results">
    {{if .Results}}
    {{range .Results}}
    <div class="search-result">
        <div class="result-info">
            <h3>{{.Name}}</h3>
            <div class="platform-tags">
                {{range .Platforms}}
                <span class="platform-tag">{{.}}</span>
                {{end}}
            </div>
            <p class="result-handles">
                {{range $platform, $handle := .Handles}}
                <span>{{$platform}}: {{$handle}}</span>
                {{end}}
            </p>
        </div>
        <div class="result-actions">
            {{$isFollowed := false}}
            {{range $handle := .Handles}}
            {{if index $.FollowedHandles $handle}}
            {{$isFollowed = true}}
            {{end}}
            {{end}}
            {{if $isFollowed}}
            <span class="btn btn-secondary" style="cursor: default;">In Programme</span>
            {{else}}
            <form action="/streamer/add" method="POST" style="display: inline;">
                <input type="hidden" name="platform" value="kick">
                <input type="hidden" name="handle" value="{{index .Handles " kick"}}">
                <button type="submit" class="btn btn-primary">Add to Tracker</button>
            </form>
            {{end}}
        </div>
    </div>
    {{end}}
    {{else}}
    <div class="empty-state">
        {{if .Query}}
        <h3>No results found</h3>
        <p>No streamers found matching "{{.Query}}". Try a different search term.</p>
        {{else}}
        <h3>Search for streamers</h3>
        <p>Enter a streamer name above to search on Kick.</p>
        {{end}}
    </div>
    {{end}}
</div>
{{end}}